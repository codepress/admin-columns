function cpac_submit_form(n){var t=n(".sidebox a.submit, .column-footer a.submit");t.click(function(){var e=n(this),i=e.closest(".columns-container").addClass("saving"),c=i.find(".ac-columns form").serialize(),a=i.find(".ajax-message");t.attr("disabled","disabled"),i.find(".ajax-message").hide().removeClass("error updated"),n(".cpac_message").remove();var o=n.post(ajaxurl,{plugin_id:"cpac",action:"cpac_columns_save",data:c,_ajax_nonce:cpac._ajax_nonce,list_screen:i.data("type")},function(n){n&&(n.success?(a.addClass("updated").find("p").html(n.data),a.slideDown(),i.addClass("stored")):n.data&&(a.addClass(n.data.type).find("p").html(n.data.message),a.slideDown()))},"json");o.fail(function(n){}),o.always(function(){t.removeAttr("disabled","disabled"),i.removeClass("saving")}),n(document).trigger("cac_update",i)})}function cpac_add_column(n){n(".add_column").click(function(t){t.preventDefault();var e=n("#add-new-column-template").find(".ac-column").clone();e.cpac_update_clone_id(cpac.list_screen),e.addClass("opened").find(".ac-column-body").slideDown(150,function(){n("html, body").animate({scrollTop:e.offset().top-58},300)}),n(".ac-columns form").append(e),e.column_bind_toggle(),e.column_bind_remove(),e.column_bind_clone(),e.column_bind_events(),n(document).trigger("column_add",e)})}function cpac_sidebar_feedback(n){var t=n(".sidebox#direct-feedback");t.find("#feedback-choice a.no").click(function(n){n.preventDefault(),t.find("#feedback-choice").slideUp(),t.find("#feedback-support").slideDown()}),t.find("#feedback-choice a.yes").click(function(n){n.preventDefault(),t.find("#feedback-choice").slideUp(),t.find("#feedback-rate").slideDown()})}function cpac_init(n){var t=n(".columns-container"),e=t.find(".ac-boxes");if(e.hasClass("disabled"))e.find(".ac-column").each(function(t,e){n(e).column_bind_toggle(),n(e).find("input, select").prop("disabled",!0)});else{var i=e.find(".ac-columns");i.find(".ac-column").each(function(t,e){n(e).column_bind_toggle(),n(e).column_bind_remove(),n(e).column_bind_clone(),n(e).cpac_bind_indicator_events()}),i.cpac_bind_ordering()}n(document).trigger("cac_menu_change",i),n(document).trigger("cac_model_ready",t.data("type"))}function cpac_menu(n){n("#ac_list_screen").on("change",function(){n(this).prop("disabled",!0).next(".spinner").css("display","inline-block"),n(".view-link").hide(),window.location=n(this).val()})}function cpac_reset_columns(n){var t=n(".columns-container");n("a[data-clear-columns]").on("click",function(){t.find(".ac-column").each(function(){n(this).find(".remove-button").trigger("click")})})}var cpac,cpac_i18n;jQuery(document).ready(function(n){return 0!==n("#cpac").length&&(cpac_init(n),cpac_submit_form(n),cpac_reset_columns(n),cpac_menu(n),cpac_add_column(n),void cpac_sidebar_feedback(n))}),function(n){n.fn.column_bind_toggle=function(){var t=n(this),e=t.closest(".ac-boxes").hasClass("disabled");t.find('[data-toggle="column"]').click(function(i){i.preventDefault(),t.toggleClass("opened").find(".ac-column-body").slideToggle(150),e||(t.hasClass("events-binded")||t.column_bind_events(),t.addClass("events-binded"),n(document).trigger("column_init",n.column))}).css("cursor","pointer")},n.fn.column_bind_remove=function(){n(this).find(".remove-button").click(function(t){n(this).closest(".ac-column").column_remove(),t.preventDefault()})},n.fn.column_bind_clone=function(){n(this).find(".clone-button").click(function(t){t.preventDefault();var e=n(this).closest(".ac-column").column_clone();"undefined"!=typeof e&&e.removeClass("loading").hide().slideDown()})},n.fn.cpac_column_refresh=function(){var t=n(this),e=t.find('[data-refresh="column"]'),i=n(this).closest(".columns-container"),c=n(this).data("column-name"),a=n(this).parents("form").serialize();t.addClass("loading"),e.prop("disabled",1);var o=n.post(ajaxurl,{plugin_id:"cpac",action:"cpac_column_refresh",_ajax_nonce:cpac._ajax_nonce,column:c,formdata:a,list_screen:i.data("type")},function(e){if(e){var i=n("<div>"+e.data+"</div>").children();t.replaceWith(i),t=i,t.column_bind_toggle(),t.column_bind_remove(),t.column_bind_clone(),t.column_bind_events(),t.addClass("opened").find(".ac-column-body").show(),n(document).trigger("column_change",t)}},"json");o.fail(function(n){var e=t.closest(".columns-container").find(".ajax-message");e.addClass("error").find("p").html(cpac_i18n.error),e.slideDown(),t.slideUp(function(){t.remove()}),console.log("responseText: "+n.responseText)}),o.always(function(){t.removeClass("loading"),e.prop("disabled",!1)})},n.fn.column_bind_events=function(){var t=n(this),e=t.closest(".columns-container "),i=e.attr("data-type"),c=t.find(".column-type select option:selected").val();t.find("select.ac-setting-input_type").change(function(){var a=n("optgroup",this).children(":selected"),o=a.val(),d=n(this).next(".msg").hide(),s=n(this),l=[];e.find(".ac-column[data-original=1]").each(function(){l.push(n(this).data("type"))}),t.addClass("loading"),n.ajax({url:ajaxurl,method:"post",dataType:"json",data:{plugin_id:"cpac",action:"cpac_column_select",original_columns:l,_ajax_nonce:cpac._ajax_nonce,type:o,list_screen:i}}).done(function(i){if(i)if(i.success){var a=t.closest(".ac-column"),o=n("<div>"+i.data+"</div>").children();a.replaceWith(o),a=o,a.column_bind_toggle(),a.column_bind_remove(),a.column_bind_clone(),a.column_bind_events(),a.addClass("opened").find(".ac-column-body").show(),a.cpac_update_clone_id(e.attr("data-type")),n(document).trigger("column_change",a)}else i.data&&"message"===i.data.type&&(d.html(i.data.error).show(),s.find("option").removeAttr("selected"),s.find('option[value="'+c+'"]').attr("selected","selected"))}).always(function(){t.removeClass("loading")})}),t.find(".ac-setting-input-label input").bind("keyup change",function(){var t=n(this).val();n(this).closest(".ac-column").find("td.column_label .inner > a.toggle").text(t)}),t.find(".ac-column-body .col-label .label").hover(function(){n(this).parents(".col-label").find("div.tooltip").show()},function(){n(this).parents(".col-label").find("div.tooltip").hide()}),t.find('[data-refresh="column"]').change(function(){t.cpac_column_refresh()}),n(document).trigger("init_settings",t)},n.fn.column_bind_settings=function(){var t=n(this);t.find(".ac-column-setting--image_size").cpac_column_setting_image_size(),t.find(".ac-column-setting--width").cpac_column_setting_width()},n.fn.column_remove=function(){n(this).addClass("deleting").animate({opacity:0,height:0},350,function(){n(this).remove()})},n.fn.column_clone=function(){var t=n(this).closest(".columns-container"),e=n(this),i=n(this).closest("ac-columns");if("1"===e.attr("data-original")){var c=cpac_i18n.clone.replace("%s","<strong>"+e.find(".column_label .toggle").text()+"</strong>");return e.addClass("opened").find(".ac-column-body").slideDown(150),void e.find(".ac-setting-input_type").next(".msg").html(c).show()}var a=n(this).clone();return a.cpac_update_clone_id(t.attr("data-type")),n(this).after(a),a.column_bind_toggle(),a.column_bind_remove(),a.column_bind_clone(),a.column_bind_events(),i.cpac_bind_ordering(),n(document).trigger("column_add",a),a},n.fn.cpac_update_clone_id=function(t){var e=n(this),i=e.attr("data-type"),c=n('.columns-container[data-type="'+t+'"]').find(".ac-columns"),a=n(c).find('*[data-type="'+i+'"]').not(e),o=n.map(a,function(t){return n(t).attr("data-clone")?parseInt(n(t).attr("data-clone"),10):0});o.sort();for(var d=Math.max.apply(null,o)+1,s=0;s<=d&&-1!==n.inArray(s,o);s++);var l=e.attr("data-clone"),u="";l>0&&(u="-"+l),e.attr("data-clone",s),e.attr("data-column-name",i+"-"+s);var r=e.find("input, select, label");n(r).each(function(t,e){var c=i+"-"+s;n(e).attr("name")&&n(e).attr("name",n(e).attr("name").replace("["+i+u+"]","["+c+"]")),n(e).attr("for")&&n(e).attr("for",n(e).attr("for").replace(i+u+"-",c+"-")),n(e).attr("id")&&n(e).attr("id",n(e).attr("id").replace(i+u+"-",c+"-"))})},n(document).bind("column_init column_change column_add",function(t,e){var i=n(e).closest(".ac-boxes").hasClass("disabled");i||(n(e).cpac_bind_column_addon_events(),n(e).cpac_bind_indicator_events())}),n.fn.cpac_bind_column_addon_events=function(){var t=n(this),e=t.find("[data-trigger] label");e.on("click",function(){var e=n(this).closest("td.input").data("trigger"),i=n("input",this).val(),c=t.find('[data-indicator-id="'+e+'"]').removeClass("on");"on"==i&&c.addClass("on");var a=t.find('[data-handle="'+e+'"]').addClass("hide");"on"==i&&a.removeClass("hide")}),t.find("[data-trigger]").each(function(){var e=n(this).data("trigger"),i=t.find('[data-handle="'+e+'"]').addClass("hide");"on"==n("input:checked",this).val()&&i.removeClass("hide")})},n.fn.cpac_bind_indicator_events=function(){var t=n(this),e=t.find(".ac-column-header [data-indicator-toggle]");e.each(function(){var e=n(this),i=n(this).data("setting"),c=t.find(".ac-column-setting[data-setting="+i+"]"),a=c.find(".col-input:first .ac-setting-input:first input[type=radio]");e.unbind("click").on("click",function(t){t.preventDefault(),e.toggleClass("on"),n(this).hasClass("on")?a.filter("[value=on]").prop("checked",!0).trigger("click").trigger("change"):a.filter("[value=off]").prop("checked",!0).trigger("click").trigger("change")}),a.on("change",function(){var n=a.filter(":checked").val();"on"==n?e.addClass("on"):e.removeClass("on")})})},n.fn.cpac_bind_ordering=function(){n(this).each(function(){n(this).hasClass("ui-sortable")?n(this).sortable("refresh"):n(this).sortable({items:".ac-column",handle:".column_sort"})})}}(jQuery),function(n){n.fn.cpac_column_setting_image_size=function(){function t(n,t){"cpac-custom"==t.val()?n.find(".ac-column-setting").show():n.find(".ac-column-setting").hide()}n(this).each(function(){var e=n(this),i=n(this).find(".ac-setting-input select");t(e,i),i.on("change",function(){t(e,n(this))})})},n(document).on("init_settings",function(t,e){n(e).find(".ac-column-setting--image").cpac_column_setting_image_size()})}(jQuery),function(n){n.fn.column_width_slider=function(){var t=n(this).find(".ac-setting-input-width"),e=t.find(".description input"),i=t.find(".unit-select input"),c=i.filter(":checked").val(),a=e.val(),o=t.find(".width-slider"),d=n(this).find(".ac-column-header .ac-column-heading-setting--width");"%"==c&&a>100&&(a=100),e.val(a),o.slider({range:"min",min:0,max:"%"==c?100:500,value:a,slide:function(n,t){e.val(t.value),d.trigger("update"),e.trigger("validate")}})},n.fn.cpac_column_setting_width=function(){n(this).each(function(){var t=n(this).parents(".ac-column");t.column_width_slider();var e=t.find(".ac-column-header .ac-column-heading-setting--width");e.on("update",function(){var e=t.find(".ac-setting-input-width .description input").val(),i=t.find(".ac-setting-input-width .description .unit").text();e>0?n(this).text(e+i):n(this).text("")});var i=t.find(".ac-setting-input-width .unit-select label");i.on("click",function(){t.find("span.unit").text(n(this).find("input").val()),t.column_width_slider(),e.trigger("update")});var c=t.find(".ac-setting-input-width .description input").on("keyup",function(){t.column_width_slider(),n(this).trigger("validate"),e.trigger("update")}).on("validate",function(){var t=c.val(),e=n.trim(t);n.isNumeric(e)||(e=e.replace(/\D/g,"")),e.length>3&&(e=e.substring(0,3)),e<=0&&(e=""),e!==t&&c.val(e)})})},n(document).on("init_settings",function(t,e){n(e).find(".ac-column-setting--width").cpac_column_setting_width()})}(jQuery),function(n){n.fn.cpac_column_sub_setting_toggle=function(t){function e(n,t){var e=t.filter(":checked").val(),c=n.find(i.subfield);i.value_show==e?c.show():c.hide()}var i=n.extend({value_show:"on",subfield:".ac-column-setting"},t);n(this).each(function(){var t=n(this),i=n(this).find('.ac-setting-input input[type="radio"]');e(t,i),i.on("change",function(){e(t,i)})})},n(document).on("init_settings",function(t,e){n(e).find(".ac-column-setting--filter").cpac_column_sub_setting_toggle(),n(e).find(".ac-column-setting--sort").cpac_column_sub_setting_toggle(),n(e).find(".ac-column-setting--edit").cpac_column_sub_setting_toggle()})}(jQuery);